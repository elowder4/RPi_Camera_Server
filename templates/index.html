<html>
    <head>
        <meta name = "viewport" content = "width = device-width, initial-scale=1">
        <style>
            img{ display: block;
                margin-left: auto;
                margin-right: auto;
            }
            h1 {text-align: center;}
        </style>
        <title>Prusa MK3S Stream</title>
    </head>
    
    <body>
        <h1>Prusa MK3S Live</h1>
        <p>Capture FPS: <span id="fps-capture">Loading...</span></p>
        <p>Stream FPS: <span id="fps-stream">Loading...</span></p>
        <img id="video" src="{{ url_for('video_feed') }}" width="640" height="480">
    </body>
    
    <script>
        function updateFPS() {
        fetch('/get_fps')
            .then(response => response.json())
            .then(data => {
                // data is a number here
                document.getElementById('fps-capture').textContent = data.toFixed(2);
            })
            .catch(err => console.warn('FPS fetch error:', err));
        }
        
        // Call updateFPS every 1 second
        setInterval(updateFPS, 1000);
        updateFPS(); // initial call
        
        const img = document.getElementById('video');
        let lastTime = performance.now();
        let fpsSamples = [];
    
        img.onload = () => {
            const now = performance.now();
            const delta = now - lastTime;
            lastTime = now;
    
            const fps = 1000 / delta;
    
            fpsSamples.push(fps);
            if (fpsSamples.length > 10) fpsSamples.shift();
    
            const avgFps = fpsSamples.reduce((a,b) => a+b, 0) / fpsSamples.length;
            document.getElementById('fps-stream').textContent = avgFps.toFixed(1);
        };
    
        img.onerror = () => {
            console.warn("Image load error");
        };
  };
    
    </script>
</html>